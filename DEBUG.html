<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>üîç DEBUG - Diagn√≥stico Completo</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
        }
        .section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #00ff00;
            border-radius: 4px;
        }
        .btn {
            background: #00ff00;
            color: #000;
            padding: 15px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #00cc00;
        }
        .error { color: #ff4444; }
        .success { color: #00ff00; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        h1 { color: #fff; }
        h2 { color: #00ff00; border-bottom: 2px solid #00ff00; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>üîç DEBUG - Diagn√≥stico Completo do Sistema</h1>

    <div class="section">
        <h2>Passo 1: Limpar e Resetar</h2>
        <button class="btn" onclick="limparTudo()">üóëÔ∏è LIMPAR TUDO E RECARREGAR</button>
        <p>Isso vai:</p>
        <ul>
            <li>Limpar localStorage</li>
            <li>Recarregar a p√°gina</li>
            <li>Come√ßar do zero</li>
        </ul>
    </div>

    <div class="section">
        <h2>Passo 2: Verificar Estado Atual</h2>
        <button class="btn" onclick="verificarEstado()">üìä VERIFICAR DADOS</button>
        <pre id="estadoAtual">Clique no bot√£o acima para verificar...</pre>
    </div>

    <div class="section">
        <h2>Passo 3: Teste Completo</h2>
        <button class="btn" onclick="window.location.href='index.html'">üöÄ ABRIR SISTEMA PRINCIPAL</button>
        <button class="btn" onclick="window.location.href='TESTE-FINAL.html'">üß™ ABRIR TESTE VISUAL</button>
    </div>

    <div class="section">
        <h2>üìã Log de Eventos</h2>
        <pre id="logArea" style="height: 300px; overflow-y: auto;"></pre>
    </div>

    <script>
        function log(mensagem, tipo = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const cor = tipo === 'error' ? 'error' : tipo === 'success' ? 'success' : tipo === 'warning' ? 'warning' : 'info';
            logArea.innerHTML += `<span class="${cor}">[${timestamp}] ${mensagem}</span>\n`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(mensagem);
        }

        function limparTudo() {
            log('üóëÔ∏è Limpando localStorage...', 'warning');
            localStorage.clear();
            log('‚úÖ LocalStorage limpo!', 'success');
            log('üîÑ Recarregando em 2 segundos...', 'info');

            setTimeout(() => {
                location.reload();
            }, 2000);
        }

        function verificarEstado() {
            log('üìä Verificando estado do sistema...', 'info');

            const estadoAtual = document.getElementById('estadoAtual');
            let relatorio = '';

            // Verificar localStorage
            const keys = Object.keys(localStorage);
            relatorio += '=== LOCAL STORAGE ===\n';
            relatorio += `Total de chaves: ${keys.length}\n\n`;

            if (keys.length > 0) {
                keys.forEach(key => {
                    const valor = localStorage.getItem(key);
                    relatorio += `${key}:\n`;

                    try {
                        const parsed = JSON.parse(valor);
                        relatorio += JSON.stringify(parsed, null, 2) + '\n\n';
                    } catch (e) {
                        relatorio += valor + '\n\n';
                    }
                });
            } else {
                relatorio += 'LocalStorage VAZIO ‚úÖ\n\n';
            }

            // Verificar fornecedores
            relatorio += '\n=== VERIFICA√á√ÉO ===\n';

            const fornecedoresSalvos = localStorage.getItem('fornecedores');
            if (fornecedoresSalvos) {
                try {
                    const fornec = JSON.parse(fornecedoresSalvos);
                    relatorio += `\n‚úÖ Fornecedores encontrados: ${fornec.length}\n\n`;

                    fornec.forEach((f, i) => {
                        relatorio += `Fornecedor ${i + 1}: ${f.nome}\n`;
                        relatorio += `  Cidade: ${f.cidade}\n`;

                        if (f.distanciasClientes) {
                            const cidades = Object.keys(f.distanciasClientes);
                            relatorio += `  Cidades cadastradas: ${cidades.length}\n`;

                            cidades.forEach(cidade => {
                                const dist = f.distanciasClientes[cidade];
                                relatorio += `    - ${cidade}: ${dist} km ${dist > 0 ? '‚úÖ' : '‚ö†Ô∏è (zerado)'}\n`;
                            });
                        } else {
                            relatorio += `  ‚ùå SEM distanciasClientes!\n`;
                        }
                        relatorio += '\n';
                    });
                } catch (e) {
                    relatorio += `‚ùå Erro ao parse fornecedores: ${e.message}\n`;
                }
            } else {
                relatorio += '‚ö†Ô∏è Nenhum fornecedor salvo no localStorage\n';
                relatorio += 'üëâ Abra o sistema e ele criar√° dados de exemplo\n\n';
            }

            estadoAtual.textContent = relatorio;
            log('‚úÖ Verifica√ß√£o conclu√≠da! Veja o resultado acima.', 'success');
        }

        // Verifica√ß√£o autom√°tica ao carregar
        window.addEventListener('load', () => {
            log('üéØ DEBUG carregado!', 'success');
            log('üí° Use os bot√µes acima para diagnosticar problemas', 'info');
            log('', 'info');
            verificarEstado();
        });
    </script>
</body>
</html>
